<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Yalla API - Health</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; background:#f7fafc; color:#0f172a; display:flex; align-items:center; justify-content:center; height:100vh; margin:0; }
      .card { background:#fff; padding:24px; border-radius:8px; box-shadow:0 6px 18px rgba(15,23,42,0.08); max-width:540px; width:100%; }
      h1 { margin:0 0 8px 0; font-size:20px }
      p { margin:0 0 12px 0; color:#475569 }
      .ok { color: #059669; font-weight:600 }
      .warn { color: #b45309; font-weight:600 }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Yalla API — Health</h1>
      <p>Server status: <span class="ok">running</span></p>
      <p>Node: <small id="node"></small></p>
      <p>Uptime: <small id="uptime">—</small></p>
      <p>Mongo: <small id="mongo">unknown</small></p>
      <p>Routing: <small id="routing">unknown</small></p>
      <p>Last checked: <small id="checked">—</small></p>

      <script>
        document.getElementById('node').textContent = navigator.userAgent;

        async function refresh() {
          try {
            const res = await fetch('/health');
            const data = await res.json();
            document.getElementById('checked').textContent = new Date(data.timestamp).toLocaleString();
            document.getElementById('uptime').textContent = `${Math.floor(data.uptimeSeconds/60)}m ${data.uptimeSeconds%60}s`;
            document.getElementById('mongo').textContent = data.mongo && data.mongo.connected ? 'connected' : `state:${data.mongo.state}`;
            document.getElementById('routing').textContent = data.routing && data.routing.reachable ? `reachable (${data.routing.service})` : `unreachable`;
          } catch (err) {
            document.getElementById('checked').textContent = 'error';
            document.getElementById('mongo').textContent = 'error';
            document.getElementById('routing').textContent = 'error';
          }
        }

        refresh();
        setInterval(refresh, 5000);
      </script>
    </div>
  </body>
</html>
